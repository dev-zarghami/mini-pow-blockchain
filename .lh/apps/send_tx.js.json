{
    "sourceFile": "apps/send_tx.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 23,
            "patches": [
                {
                    "date": 1761995480368,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1761996843412,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,65 +1,58 @@\n // apps/send_tx.js\n-// create and sign a simple transaction (educational)\n-// usage: node apps/send_tx.js --fromPriv <privhex> --fromPub <pubhex> --to <address> --amount 10\n+// Create & sign a transaction (ECDSA) and send to node\n+// Run: node apps/send_tx.js --fromPriv <priv> --fromPub <pub> --to <address> --amount 10 [--fee 1] [--node http://localhost:3000]\n \n const axios = require('axios');\n const EC = require('elliptic').ec;\n-const ec = new EC('secp256k1');\n const crypto = require('crypto');\n const argv = require('minimist')(process.argv.slice(2));\n \n-const NODE = 'http://localhost:3000';\n+const ec = new EC('secp256k1');\n+const NODE = argv.node || 'http://localhost:3000';\n \n-function sha256Hex(buf) {\n-  return crypto.createHash('sha256').update(buf).digest('hex');\n-}\n-function stableStringify(obj) {\n-  return require('stable-stringify')(obj);\n-}\n+const sha256Hex = (b)=> crypto.createHash('sha256').update(b).digest('hex');\n+const stableStringify = require('stable-stringify');\n \n-(async () => {\n+(async ()=>{\n   const priv = argv.fromPriv;\n   const pub = argv.fromPub;\n   const to = argv.to;\n   const amount = Number(argv.amount);\n+  const fee = Number(argv.fee || 0);\n   if (!priv || !pub || !to || !amount) {\n-    console.error('Usage: node apps/send_tx.js --fromPriv <privhex> --fromPub <pubhex> --to <address> --amount <num>');\n+    console.error('Usage: node apps/send_tx.js --fromPriv <priv> --fromPub <pub> --to <address> --amount <num> [--fee <num>]');\n     process.exit(1);\n   }\n \n-  // fetch utxos\n-  const ut = await axios.get(`${NODE}/utxos/${pub}`);\n+  // Fetch UTXOs (address == RIPEMD160(SHA256(pub)))\n+  const sha = crypto.createHash('sha256').update(Buffer.from(pub,'hex')).digest();\n+  const fromAddress = crypto.createHash('ripemd160').update(sha).digest('hex');\n+\n+  const ut = await axios.get(`${NODE}/utxos/${fromAddress}`);\n   const utxos = ut.data.utxos;\n-  // pick utxos naive\n-  let selected = [];\n-  let sum = 0;\n+  let picked = [], sum = 0;\n   for (const u of utxos) {\n-    selected.push(u);\n-    sum += u.amount;\n-    if (sum >= amount) break;\n+    picked.push(u); sum += u.amount; if (sum >= amount + fee) break;\n   }\n-  if (sum < amount) {\n-    console.error('insufficient funds');\n-    process.exit(1);\n-  }\n-  const change = sum - amount - (argv.fee ? Number(argv.fee) : 0);\n-  const inputs = selected.map(s => ({ txid: s.txid, index: s.index, pubKey: pub }));\n+  if (sum < amount + fee) { console.error('insufficient funds'); process.exit(1); }\n+\n+  const change = sum - amount - fee;\n+  const inputs = picked.map(u => ({ txid: u.txid, index: u.index, pubKey: pub }));\n   const outputs = [{ address: to, amount }];\n-  if (change > 0) outputs.push({ address: pub, amount: change });\n+  if (change > 0) outputs.push({ address: fromAddress, amount: change });\n \n-  const tx = { inputs, outputs };\n-  // sign inputs (educational: signature = sign(txidForSigning))\n-  const txid = sha256Hex(Buffer.from(stableStringify({ inputs: tx.inputs.map(i => ({txid:i.txid,index:i.index})), outputs: tx.outputs })));\n-  // sign with priv\n+  const unsignedPayload = {\n+    inputs: inputs.map(i => ({ txid: i.txid, index: i.index })),\n+    outputs: outputs.map(o => ({ address: o.address, amount: o.amount }))\n+  };\n+  const msg = sha256Hex(Buffer.from(stableStringify(unsignedPayload)));\n+\n   const key = ec.keyFromPrivate(priv);\n-  const sig = key.sign(txid);\n-  const sigHex = Buffer.from(sig.toDER()).toString('hex');\n-  // attach signatures per input\n-  for (let i = 0; i < tx.inputs.length; i++) {\n-    tx.inputs[i].sig = sigHex;\n-  }\n-  tx.id = sha256Hex(Buffer.from(stableStringify({ inputs: tx.inputs.map(i => ({txid:i.txid,index:i.index})), outputs: tx.outputs })));\n-  // submit\n-  const res = await axios.post(`${NODE}/transactions`, tx);\n-  console.log('submitted', res.data);\n+  const sigDER = Buffer.from(key.sign(msg).toDER()).toString('hex');\n+\n+  const tx = { inputs: inputs.map(i => ({...i, sig: sigDER})), outputs };\n+  tx.id = sha256Hex(Buffer.from(stableStringify(unsignedPayload)));\n+\n+  const r = await axios.post(`${NODE}/transactions`, tx);\n+  console.log('submitted tx:', r.data);\n })();\n"
                },
                {
                    "date": 1762003136672,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,9 +10,8 @@\n const ec = new EC('secp256k1');\n const NODE = argv.node || 'http://localhost:3000';\n \n const sha256Hex = (b)=> crypto.createHash('sha256').update(b).digest('hex');\n-const stableStringify = require('stable-stringify');\n \n (async ()=>{\n   const priv = argv.fromPriv;\n   const pub = argv.fromPub;\n@@ -44,15 +43,15 @@\n   const unsignedPayload = {\n     inputs: inputs.map(i => ({ txid: i.txid, index: i.index })),\n     outputs: outputs.map(o => ({ address: o.address, amount: o.amount }))\n   };\n-  const msg = sha256Hex(Buffer.from(stableStringify(unsignedPayload)));\n+  const msg = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n \n   const key = ec.keyFromPrivate(priv);\n   const sigDER = Buffer.from(key.sign(msg).toDER()).toString('hex');\n \n   const tx = { inputs: inputs.map(i => ({...i, sig: sigDER})), outputs };\n-  tx.id = sha256Hex(Buffer.from(stableStringify(unsignedPayload)));\n+  tx.id = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n \n   const r = await axios.post(`${NODE}/transactions`, tx);\n   console.log('submitted tx:', r.data);\n })();\n"
                },
                {
                    "date": 1762005118286,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,21 @@\n-// apps/send_tx.js\n-// Create & sign a transaction (ECDSA) and send to node\n-// Run: node apps/send_tx.js --fromPriv <priv> --fromPub <pub> --to <address> --amount 10 [--fee 1] [--node http://localhost:3000]\n-\n const axios = require('axios');\n const EC = require('elliptic').ec;\n const crypto = require('crypto');\n const argv = require('minimist')(process.argv.slice(2));\n \n const ec = new EC('secp256k1');\n const NODE = argv.node || 'http://localhost:3000';\n \n+const address1 = {\n+  \n+}\n+\n+const address2 = {\n+  \n+}\n+\n+\n const sha256Hex = (b)=> crypto.createHash('sha256').update(b).digest('hex');\n \n (async ()=>{\n   const priv = argv.fromPriv;\n"
                },
                {
                    "date": 1762005173642,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n const ec = new EC('secp256k1');\n const NODE = argv.node || 'http://localhost:3000';\n \n const address1 = {\n+  privateKey:\"\",\n   \n }\n \n const address2 = {\n"
                },
                {
                    "date": 1762005198162,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,8 +7,9 @@\n const NODE = argv.node || 'http://localhost:3000';\n \n const address1 = {\n   privateKey:\"\",\n+  pubKey:\"\",\n   \n }\n \n const address2 = {\n"
                },
                {
                    "date": 1762005206732,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,21 +6,23 @@\n const ec = new EC('secp256k1');\n const NODE = argv.node || 'http://localhost:3000';\n \n const address1 = {\n-  privateKey:\"\",\n-  pubKey:\"\",\n-  \n+  privateKey: \"\",\n+  pubKey: \"\",\n+  address: \"\"\n }\n \n const address2 = {\n-  \n+  privateKey: \"\",\n+  pubKey: \"\",\n+  address: \"\"\n }\n \n \n-const sha256Hex = (b)=> crypto.createHash('sha256').update(b).digest('hex');\n+const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n-(async ()=>{\n+(async () => {\n   const priv = argv.fromPriv;\n   const pub = argv.fromPub;\n   const to = argv.to;\n   const amount = Number(argv.amount);\n@@ -30,9 +32,9 @@\n     process.exit(1);\n   }\n \n   // Fetch UTXOs (address == RIPEMD160(SHA256(pub)))\n-  const sha = crypto.createHash('sha256').update(Buffer.from(pub,'hex')).digest();\n+  const sha = crypto.createHash('sha256').update(Buffer.from(pub, 'hex')).digest();\n   const fromAddress = crypto.createHash('ripemd160').update(sha).digest('hex');\n \n   const ut = await axios.get(`${NODE}/utxos/${fromAddress}`);\n   const utxos = ut.data.utxos;\n@@ -55,9 +57,9 @@\n \n   const key = ec.keyFromPrivate(priv);\n   const sigDER = Buffer.from(key.sign(msg).toDER()).toString('hex');\n \n-  const tx = { inputs: inputs.map(i => ({...i, sig: sigDER})), outputs };\n+  const tx = { inputs: inputs.map(i => ({ ...i, sig: sigDER })), outputs };\n   tx.id = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n \n   const r = await axios.post(`${NODE}/transactions`, tx);\n   console.log('submitted tx:', r.data);\n"
                },
                {
                    "date": 1762005212539,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,10 +6,10 @@\n const ec = new EC('secp256k1');\n const NODE = argv.node || 'http://localhost:3000';\n \n const address1 = {\n-  privateKey: \"\",\n-  pubKey: \"\",\n+  privateKey: \"478a542382de4171e718b581e555edab64e1434c1573968e66a9b0fffd1ea7eb\",\n+  pubKey: \"03f3ef726d1db5516307daf5dea92d69e52264e9ad7d3817767181c1acedd8a650\",\n   address: \"\"\n }\n \n const address2 = {\n"
                },
                {
                    "date": 1762005219148,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,13 +8,13 @@\n \n const address1 = {\n   privateKey: \"478a542382de4171e718b581e555edab64e1434c1573968e66a9b0fffd1ea7eb\",\n   pubKey: \"03f3ef726d1db5516307daf5dea92d69e52264e9ad7d3817767181c1acedd8a650\",\n-  address: \"\"\n+  address: \"0a0cf279ea90a30a5cfc8593376146b5bcde7564\"\n }\n \n const address2 = {\n-  privateKey: \"\",\n+  privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n   pubKey: \"\",\n   address: \"\"\n }\n \n"
                },
                {
                    "date": 1762005252870,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,21 +5,27 @@\n \n const ec = new EC('secp256k1');\n const NODE = argv.node || 'http://localhost:3000';\n \n-const address1 = {\n-  privateKey: \"478a542382de4171e718b581e555edab64e1434c1573968e66a9b0fffd1ea7eb\",\n-  pubKey: \"03f3ef726d1db5516307daf5dea92d69e52264e9ad7d3817767181c1acedd8a650\",\n-  address: \"0a0cf279ea90a30a5cfc8593376146b5bcde7564\"\n+const address = {\n+  1: {\n+    privateKey: \"478a542382de4171e718b581e555edab64e1434c1573968e66a9b0fffd1ea7eb\",\n+    pubKey: \"03f3ef726d1db5516307daf5dea92d69e52264e9ad7d3817767181c1acedd8a650\",\n+    address: \"0a0cf279ea90a30a5cfc8593376146b5bcde7564\"\n+  },\n+  2: {\n+    privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n+    pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n+    address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n+  },\n+  3: {\n+    privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n+    pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n+    address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n+  }\n }\n \n-const address2 = {\n-  privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n-  pubKey: \"\",\n-  address: \"\"\n-}\n \n-\n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n (async () => {\n   const priv = argv.fromPriv;\n"
                },
                {
                    "date": 1762005265568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,13 +16,9 @@\n     privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n     pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n     address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n   },\n-  3: {\n-    privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n-    pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n-    address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n-  }\n+\n }\n \n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n"
                },
                {
                    "date": 1762005272450,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,9 +16,8 @@\n     privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n     pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n     address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n   },\n-\n }\n \n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n"
                },
                {
                    "date": 1762005354259,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,16 @@\n+// send_tx.js\n+// Example usage: node send_tx.js --index 1 --to <recipientAddress> --amount 10 [--fee 1] [--node http://localhost:3000]\n+\n const axios = require('axios');\n const EC = require('elliptic').ec;\n const crypto = require('crypto');\n const argv = require('minimist')(process.argv.slice(2));\n \n const ec = new EC('secp256k1');\n const NODE = argv.node || 'http://localhost:3000';\n \n-const address = {\n+const addressBook = {\n   1: {\n     privateKey: \"478a542382de4171e718b581e555edab64e1434c1573968e66a9b0fffd1ea7eb\",\n     pubKey: \"03f3ef726d1db5516307daf5dea92d69e52264e9ad7d3817767181c1acedd8a650\",\n     address: \"0a0cf279ea90a30a5cfc8593376146b5bcde7564\"\n@@ -16,52 +19,70 @@\n     privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n     pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n     address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n   },\n-}\n+};\n \n-\n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n (async () => {\n-  const priv = argv.fromPriv;\n-  const pub = argv.fromPub;\n+  // Determine which sender to use\n+  const idx = argv.index;\n+  const sender = addressBook[idx];\n+  if (!sender) {\n+    console.error(\"Invalid or missing --index (must be 1 or 2).\");\n+    process.exit(1);\n+  }\n+\n+  const fromPriv = sender.privateKey;\n+  const fromPub = sender.pubKey;\n+  const fromAddress = sender.address;\n+\n   const to = argv.to;\n   const amount = Number(argv.amount);\n   const fee = Number(argv.fee || 0);\n-  if (!priv || !pub || !to || !amount) {\n-    console.error('Usage: node apps/send_tx.js --fromPriv <priv> --fromPub <pub> --to <address> --amount <num> [--fee <num>]');\n+  if (!to || !amount) {\n+    console.error(\"Usage: node send_tx.js --index <1|2> --to <address> --amount <num> [--fee <num>] [--node <url>]\");\n     process.exit(1);\n   }\n \n-  // Fetch UTXOs (address == RIPEMD160(SHA256(pub)))\n-  const sha = crypto.createHash('sha256').update(Buffer.from(pub, 'hex')).digest();\n-  const fromAddress = crypto.createHash('ripemd160').update(sha).digest('hex');\n+  console.log(`From: ${fromAddress}\\nTo:   ${to}\\nAmount: ${amount} + Fee: ${fee}`);\n \n+  // Fetch UTXOs for the sender\n   const ut = await axios.get(`${NODE}/utxos/${fromAddress}`);\n   const utxos = ut.data.utxos;\n   let picked = [], sum = 0;\n   for (const u of utxos) {\n-    picked.push(u); sum += u.amount; if (sum >= amount + fee) break;\n+    picked.push(u);\n+    sum += u.amount;\n+    if (sum >= amount + fee) break;\n   }\n-  if (sum < amount + fee) { console.error('insufficient funds'); process.exit(1); }\n+  if (sum < amount + fee) {\n+    console.error(\"Insufficient funds\");\n+    process.exit(1);\n+  }\n \n   const change = sum - amount - fee;\n-  const inputs = picked.map(u => ({ txid: u.txid, index: u.index, pubKey: pub }));\n+  const inputs = picked.map(u => ({ txid: u.txid, index: u.index, pubKey: fromPub }));\n   const outputs = [{ address: to, amount }];\n   if (change > 0) outputs.push({ address: fromAddress, amount: change });\n \n+  // Sign transaction\n   const unsignedPayload = {\n     inputs: inputs.map(i => ({ txid: i.txid, index: i.index })),\n-    outputs: outputs.map(o => ({ address: o.address, amount: o.amount }))\n+    outputs: outputs.map(o => ({ address: o.address, amount: o.amount })),\n   };\n   const msg = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n-\n-  const key = ec.keyFromPrivate(priv);\n+  const key = ec.keyFromPrivate(fromPriv);\n   const sigDER = Buffer.from(key.sign(msg).toDER()).toString('hex');\n \n   const tx = { inputs: inputs.map(i => ({ ...i, sig: sigDER })), outputs };\n   tx.id = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n \n-  const r = await axios.post(`${NODE}/transactions`, tx);\n-  console.log('submitted tx:', r.data);\n+  // Send transaction\n+  try {\n+    const r = await axios.post(`${NODE}/transactions`, tx);\n+    console.log(\"Submitted tx:\", r.data);\n+  } catch (e) {\n+    console.error(\"Error submitting tx:\", e.response ? e.response.data : e.message);\n+  }\n })();\n"
                },
                {
                    "date": 1762005572044,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,11 +24,10 @@\n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n (async () => {\n-  // Determine which sender to use\n-  const idx = argv.index;\n-  const sender = addressBook[idx];\n+  const sender = addressBook[argv.from];\n+  const sender = addressBook[argv.to];\n   if (!sender) {\n     console.error(\"Invalid or missing --index (must be 1 or 2).\");\n     process.exit(1);\n   }\n"
                },
                {
                    "date": 1762005605424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,10 +24,10 @@\n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n (async () => {\n-  const sender = addressBook[argv.from];\n-  const sender = addressBook[argv.to];\n+  const from = addressBook[argv.from];\n+  const to = addressBook[argv.to];\n   if (!sender) {\n     console.error(\"Invalid or missing --index (must be 1 or 2).\");\n     process.exit(1);\n   }\n@@ -35,9 +35,8 @@\n   const fromPriv = sender.privateKey;\n   const fromPub = sender.pubKey;\n   const fromAddress = sender.address;\n \n-  const to = argv.to;\n   const amount = Number(argv.amount);\n   const fee = Number(argv.fee || 0);\n   if (!to || !amount) {\n     console.error(\"Usage: node send_tx.js --index <1|2> --to <address> --amount <num> [--fee <num>] [--node <url>]\");\n"
                },
                {
                    "date": 1762005700360,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n // send_tx.js\n-// Example usage: node send_tx.js --index 1 --to <recipientAddress> --amount 10 [--fee 1] [--node http://localhost:3000]\n+// Example usage:\n+//   node send_tx.js --from 1 --to 2 --amount 5 [--fee 1] [--node http://localhost:3000]\n \n const axios = require('axios');\n const EC = require('elliptic').ec;\n const crypto = require('crypto');\n@@ -24,63 +25,90 @@\n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n (async () => {\n-  const from = addressBook[argv.from];\n-  const to = addressBook[argv.to];\n-  if (!sender) {\n-    console.error(\"Invalid or missing --index (must be 1 or 2).\");\n+  const sender = addressBook[argv.from];\n+  const recipient = addressBook[argv.to];\n+\n+  if (!sender || !recipient) {\n+    console.error(\"‚ùå Invalid or missing --from / --to (must be 1 or 2).\");\n     process.exit(1);\n   }\n \n   const fromPriv = sender.privateKey;\n   const fromPub = sender.pubKey;\n   const fromAddress = sender.address;\n+  const toAddress = recipient.address;\n \n   const amount = Number(argv.amount);\n   const fee = Number(argv.fee || 0);\n-  if (!to || !amount) {\n-    console.error(\"Usage: node send_tx.js --index <1|2> --to <address> --amount <num> [--fee <num>] [--node <url>]\");\n+\n+  if (!amount || amount <= 0) {\n+    console.error(\"‚ùå Invalid or missing --amount.\");\n     process.exit(1);\n   }\n \n-  console.log(`From: ${fromAddress}\\nTo:   ${to}\\nAmount: ${amount} + Fee: ${fee}`);\n+  console.log(`\\nüöÄ Preparing transaction:\n+From: ${fromAddress}\n+To:   ${toAddress}\n+Amount: ${amount}\n+Fee: ${fee}\n+`);\n \n-  // Fetch UTXOs for the sender\n-  const ut = await axios.get(`${NODE}/utxos/${fromAddress}`);\n-  const utxos = ut.data.utxos;\n+  // Fetch UTXOs\n+  let utxos;\n+  try {\n+    const res = await axios.get(`${NODE}/utxos/${fromAddress}`);\n+    utxos = res.data.utxos || [];\n+  } catch (err) {\n+    console.error(\"‚ùå Error fetching UTXOs:\", err.message);\n+    process.exit(1);\n+  }\n+\n+  if (utxos.length === 0) {\n+    console.error(\"‚ùå No UTXOs found for sender.\");\n+    process.exit(1);\n+  }\n+\n+  // Select inputs\n   let picked = [], sum = 0;\n   for (const u of utxos) {\n     picked.push(u);\n     sum += u.amount;\n     if (sum >= amount + fee) break;\n   }\n   if (sum < amount + fee) {\n-    console.error(\"Insufficient funds\");\n+    console.error(\"‚ùå Insufficient funds.\");\n     process.exit(1);\n   }\n \n   const change = sum - amount - fee;\n   const inputs = picked.map(u => ({ txid: u.txid, index: u.index, pubKey: fromPub }));\n-  const outputs = [{ address: to, amount }];\n+  const outputs = [{ address: toAddress, amount }];\n   if (change > 0) outputs.push({ address: fromAddress, amount: change });\n \n-  // Sign transaction\n+  // Create unsigned payload\n   const unsignedPayload = {\n     inputs: inputs.map(i => ({ txid: i.txid, index: i.index })),\n     outputs: outputs.map(o => ({ address: o.address, amount: o.amount })),\n   };\n-  const msg = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n+\n+  // Sign\n+  const msgHash = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n   const key = ec.keyFromPrivate(fromPriv);\n-  const sigDER = Buffer.from(key.sign(msg).toDER()).toString('hex');\n+  const sigDER = Buffer.from(key.sign(msgHash).toDER()).toString('hex');\n \n+  // Build final tx\n   const tx = { inputs: inputs.map(i => ({ ...i, sig: sigDER })), outputs };\n-  tx.id = sha256Hex(Buffer.from(JSON.stringify(unsignedPayload)));\n+  tx.id = msgHash;\n \n-  // Send transaction\n+  console.log(\"üßæ Transaction created:\\n\", JSON.stringify(tx, null, 2));\n+\n+  // Submit\n   try {\n     const r = await axios.post(`${NODE}/transactions`, tx);\n-    console.log(\"Submitted tx:\", r.data);\n+    console.log(\"\\n‚úÖ Transaction submitted successfully!\");\n+    console.log(\"Response:\", r.data);\n   } catch (e) {\n-    console.error(\"Error submitting tx:\", e.response ? e.response.data : e.message);\n+    console.error(\"‚ùå Error submitting tx:\", e.response ? e.response.data : e.message);\n   }\n })();\n"
                },
                {
                    "date": 1762008378889,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,8 +58,24 @@\n   let utxos;\n   try {\n     const res = await axios.get(`${NODE}/utxos/${fromAddress}`);\n     utxos = res.data.utxos || [];\n+    // Get blockchain tip height\n+    let chainTip;\n+    try {\n+      const tipRes = await axios.get(`${NODE}/tip`);\n+      chainTip = tipRes.data.index;\n+    } catch {\n+      chainTip = 0;\n+    }\n+\n+    // Filter out immature coinbase UTXOs\n+    const coinbaseMaturity = 2; // ŸáŸÖÿßŸÜ ŸÖŸÇÿØÿßÿ±€å ⁄©Ÿá ÿØÿ± server.js ÿ™ŸÜÿ∏€åŸÖ ÿ¥ÿØŸá\n+    utxos = utxos.filter(u => {\n+      if (!u.isCoinbase) return true;\n+      return (chainTip - u.blockHeight) >= coinbaseMaturity;\n+    });\n+\n   } catch (err) {\n     console.error(\"‚ùå Error fetching UTXOs:\", err.message);\n     process.exit(1);\n   }\n"
                },
                {
                    "date": 1762008399233,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,9 +68,9 @@\n       chainTip = 0;\n     }\n \n     // Filter out immature coinbase UTXOs\n-    const coinbaseMaturity = 2; // ŸáŸÖÿßŸÜ ŸÖŸÇÿØÿßÿ±€å ⁄©Ÿá ÿØÿ± server.js ÿ™ŸÜÿ∏€åŸÖ ÿ¥ÿØŸá\n+    const coinbaseMaturity = 2;\n     utxos = utxos.filter(u => {\n       if (!u.isCoinbase) return true;\n       return (chainTip - u.blockHeight) >= coinbaseMaturity;\n     });\n"
                },
                {
                    "date": 1762008429951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,8 +74,13 @@\n       if (!u.isCoinbase) return true;\n       return (chainTip - u.blockHeight) >= coinbaseMaturity;\n     });\n \n+    if (utxos.length === 0) {\n+      console.error(\"‚ùå No spendable (mature) UTXOs found for sender.\");\n+      process.exit(1);\n+    }\n+\n   } catch (err) {\n     console.error(\"‚ùå Error fetching UTXOs:\", err.message);\n     process.exit(1);\n   }\n"
                },
                {
                    "date": 1762008608536,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,8 +20,13 @@\n     privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n     pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n     address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n   },\n+  3: {\n+    privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n+    pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n+    address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n+  },\n };\n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n"
                },
                {
                    "date": 1762008614609,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,10 +22,10 @@\n     address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n   },\n   3: {\n     privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n-    pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n-    address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n+    pubKey: \"025540a6d748de052ad27281344fabd03595b6010f36295eca3906abe2f27e1ef5\",\n+    address: \"6578fd7739a4d86eda4cf7460db17a439f6af982\"\n   },\n };\n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n"
                },
                {
                    "date": 1762008724386,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,12 +21,17 @@\n     pubKey: \"02bbf0e463eb396ee2992aef7f92377eecdb2173e1cc920860971340af0c32ccd6\",\n     address: \"7001ea00801b23e345e997467c1abde0cf6b5207\"\n   },\n   3: {\n-    privateKey: \"bdeb98d7f08016e1697170347e00077bca74e64817d00824e25474e79e1e93f3\",\n+    privateKey: \"dfec6f1c0a48e88b182390d352fd815e3850fe0dc83950c6003bd0d974e7e9b6\",\n     pubKey: \"025540a6d748de052ad27281344fabd03595b6010f36295eca3906abe2f27e1ef5\",\n     address: \"6578fd7739a4d86eda4cf7460db17a439f6af982\"\n   },\n+  4: {\n+    privateKey: \"dfec6f1c0a48e88b182390d352fd815e3850fe0dc83950c6003bd0d974e7e9b6\",\n+    pubKey: \"025540a6d748de052ad27281344fabd03595b6010f36295eca3906abe2f27e1ef5\",\n+    address: \"6578fd7739a4d86eda4cf7460db17a439f6af982\"\n+  },\n };\n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n \n"
                },
                {
                    "date": 1762008735862,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,10 +27,10 @@\n     address: \"6578fd7739a4d86eda4cf7460db17a439f6af982\"\n   },\n   4: {\n     privateKey: \"dfec6f1c0a48e88b182390d352fd815e3850fe0dc83950c6003bd0d974e7e9b6\",\n-    pubKey: \"025540a6d748de052ad27281344fabd03595b6010f36295eca3906abe2f27e1ef5\",\n-    address: \"6578fd7739a4d86eda4cf7460db17a439f6af982\"\n+    pubKey: \"03453c76456438b9517f37ec2cd61e085275a8c085b57e9d3a539caf65d234ca0f\",\n+    address: \"7eab62390df6ce4fd2afcde38b184d29fd0cb136\"\n   },\n };\n \n const sha256Hex = (b) => crypto.createHash('sha256').update(b).digest('hex');\n"
                },
                {
                    "date": 1762008741576,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n     pubKey: \"025540a6d748de052ad27281344fabd03595b6010f36295eca3906abe2f27e1ef5\",\n     address: \"6578fd7739a4d86eda4cf7460db17a439f6af982\"\n   },\n   4: {\n-    privateKey: \"dfec6f1c0a48e88b182390d352fd815e3850fe0dc83950c6003bd0d974e7e9b6\",\n+    privateKey: \"b5688304751d0e01e57f2eaa3ba704a04db49164137a8478db43ea37ac47a8b6\",\n     pubKey: \"03453c76456438b9517f37ec2cd61e085275a8c085b57e9d3a539caf65d234ca0f\",\n     address: \"7eab62390df6ce4fd2afcde38b184d29fd0cb136\"\n   },\n };\n"
                }
            ],
            "date": 1761995480368,
            "name": "Commit-0",
            "content": "// apps/send_tx.js\n// create and sign a simple transaction (educational)\n// usage: node apps/send_tx.js --fromPriv <privhex> --fromPub <pubhex> --to <address> --amount 10\n\nconst axios = require('axios');\nconst EC = require('elliptic').ec;\nconst ec = new EC('secp256k1');\nconst crypto = require('crypto');\nconst argv = require('minimist')(process.argv.slice(2));\n\nconst NODE = 'http://localhost:3000';\n\nfunction sha256Hex(buf) {\n  return crypto.createHash('sha256').update(buf).digest('hex');\n}\nfunction stableStringify(obj) {\n  return require('stable-stringify')(obj);\n}\n\n(async () => {\n  const priv = argv.fromPriv;\n  const pub = argv.fromPub;\n  const to = argv.to;\n  const amount = Number(argv.amount);\n  if (!priv || !pub || !to || !amount) {\n    console.error('Usage: node apps/send_tx.js --fromPriv <privhex> --fromPub <pubhex> --to <address> --amount <num>');\n    process.exit(1);\n  }\n\n  // fetch utxos\n  const ut = await axios.get(`${NODE}/utxos/${pub}`);\n  const utxos = ut.data.utxos;\n  // pick utxos naive\n  let selected = [];\n  let sum = 0;\n  for (const u of utxos) {\n    selected.push(u);\n    sum += u.amount;\n    if (sum >= amount) break;\n  }\n  if (sum < amount) {\n    console.error('insufficient funds');\n    process.exit(1);\n  }\n  const change = sum - amount - (argv.fee ? Number(argv.fee) : 0);\n  const inputs = selected.map(s => ({ txid: s.txid, index: s.index, pubKey: pub }));\n  const outputs = [{ address: to, amount }];\n  if (change > 0) outputs.push({ address: pub, amount: change });\n\n  const tx = { inputs, outputs };\n  // sign inputs (educational: signature = sign(txidForSigning))\n  const txid = sha256Hex(Buffer.from(stableStringify({ inputs: tx.inputs.map(i => ({txid:i.txid,index:i.index})), outputs: tx.outputs })));\n  // sign with priv\n  const key = ec.keyFromPrivate(priv);\n  const sig = key.sign(txid);\n  const sigHex = Buffer.from(sig.toDER()).toString('hex');\n  // attach signatures per input\n  for (let i = 0; i < tx.inputs.length; i++) {\n    tx.inputs[i].sig = sigHex;\n  }\n  tx.id = sha256Hex(Buffer.from(stableStringify({ inputs: tx.inputs.map(i => ({txid:i.txid,index:i.index})), outputs: tx.outputs })));\n  // submit\n  const res = await axios.post(`${NODE}/transactions`, tx);\n  console.log('submitted', res.data);\n})();\n"
        }
    ]
}