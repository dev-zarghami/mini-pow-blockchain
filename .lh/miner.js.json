{
    "sourceFile": "miner.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 16,
            "patches": [
                {
                    "date": 1761981160924,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1761981189448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,108 +7,85 @@\n const NODE_WS = 'ws://localhost:3000';\n const MINER_ADDRESS = process.env.MINER_ADDRESS || 'your_miner_address_here';\n \n const sha256hex = d => crypto.createHash('sha256').update(d).digest('hex');\n-function blockHash(b) { return sha256hex(b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty); }\n+function blockHash(b){return sha256hex(b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty);}\n \n-function merkleRoot(txids) {\n-  if (txids.length === 0) return sha256hex('');\n-  let layer = txids.map(x => Buffer.from(x, 'hex'));\n-  while (layer.length > 1) {\n-    const next = [];\n-    for (let i = 0; i < layer.length; i += 2) {\n-      const left = layer[i];\n-      const right = layer[i + 1] || left; // duplicate odd leaf\n-      next.push(sha256(Buffer.concat([left, right])));\n-    }\n-    layer = next;\n-  }\n-  return layer[0].toString('hex');\n-}\n-\n-function headerHash(header) { // canonical, no JSON\n-  const data = [\n-    String(header.index), header.previousHash, String(header.timestamp),\n-    header.merkleRoot, String(header.nonce), String(header.difficulty)\n-  ].join('|'); // simple, deterministic serialization\n-  return sha256hex(data);\n-}\n-\n let abortFlag = false;\n let currentDiff = 1;\n \n async function buildTemplate() {\n-  const [{ data: chainData }, { data: memData }, { data: conf }] = await Promise.all([\n+  const [{data:chainData},{data:memData},{data:conf}] = await Promise.all([\n     axios.get(`${NODE_HTTP}/chain`),\n     axios.get(`${NODE_HTTP}/mempool`),\n     axios.get(`${NODE_HTTP}/config`)\n   ]);\n   const chain = chainData.chain;\n   const mempool = memData.mempool || [];\n   currentDiff = conf.difficulty;\n   const reward = conf.blockReward;\n-  const fees = mempool.reduce((a, t) => a + (t.fee || 0), 0);\n-  const last = chain[chain.length - 1];\n+  const fees = mempool.reduce((a,t)=>a+(t.fee||0),0);\n+  const last = chain[chain.length-1];\n   const index = chain.length;\n   const previousHash = last.hash;\n   const timestamp = new Date().toISOString();\n   const coinbase = {\n-    id: sha256hex('coinbase' + Date.now()),\n+    id: sha256hex('coinbase'+Date.now()),\n     inputs: [],\n     outputs: [{ address: MINER_ADDRESS, amount: reward + fees }]\n   };\n-  return { index, previousHash, timestamp, txs: [coinbase, ...mempool], diff: conf.difficulty };\n+  return {index, previousHash, timestamp, txs:[coinbase,...mempool], diff:conf.difficulty};\n }\n \n-async function mineLoop() {\n-  while (true) {\n-    try {\n+async function mineLoop(){\n+  while(true){\n+    try{\n       const tpl = await buildTemplate();\n-      const { index, previousHash, timestamp, txs, diff } = tpl;\n+      const {index,previousHash,timestamp,txs,diff} = tpl;\n       abortFlag = false;\n       console.log(`â› Mining block #${index} | diff=${diff} | txs=${txs.length}`);\n-      let nonce = 0;\n+      let nonce=0;\n       let hash;\n       const start = Date.now();\n-      while (true) {\n-        if (abortFlag) break;\n-        const block = { index, previousHash, timestamp, transactions: txs, nonce, difficulty: diff };\n+      while(true){\n+        if(abortFlag) break;\n+        const block = {index,previousHash,timestamp,transactions:txs,nonce,difficulty:diff};\n         hash = blockHash(block);\n-        if (hash.startsWith('0'.repeat(diff))) {\n+        if(hash.startsWith('0'.repeat(diff))){\n           block.hash = hash;\n-          const took = ((Date.now() - start) / 1000).toFixed(2);\n+          const took=((Date.now()-start)/1000).toFixed(2);\n           console.log(`âœ… Block mined #${index} | time=${took}s | hash=${hash}`);\n-          try {\n-            const res = await axios.post(`${NODE_HTTP}/blocks`, block);\n-            console.log('ðŸ“¦ Submitted:', res.data);\n-          } catch (e) {\n-            console.error('âŒ Submit error:', e.response?.data || e.message);\n+          try{\n+            const res = await axios.post(`${NODE_HTTP}/blocks`,block);\n+            console.log('ðŸ“¦ Submitted:',res.data);\n+          }catch(e){\n+            console.error('âŒ Submit error:',e.response?.data||e.message);\n           }\n           break;\n         }\n         nonce++;\n-        if (nonce % 100000 === 0) process.stdout.write(`\\rnonce=${nonce}`);\n+        if(nonce%100000===0) process.stdout.write(`\\rnonce=${nonce}`);\n       }\n-    } catch (e) {\n+    }catch(e){\n       console.error('Miner error:', e.message);\n     }\n   }\n }\n \n // WebSocket listening (abort+restart)\n-function startWS() {\n+function startWS(){\n   const ws = new WebSocket(NODE_WS);\n-  ws.on('open', () => console.log('ðŸ”Œ Connected to node'));\n-  ws.on('message', buf => {\n-    try {\n-      const msg = JSON.parse(buf.toString());\n-      if (['mempool_tx', 'new_block', 'config_update'].includes(msg.type)) {\n+  ws.on('open',()=>console.log('ðŸ”Œ Connected to node'));\n+  ws.on('message',buf=>{\n+    try{\n+      const msg=JSON.parse(buf.toString());\n+      if(['mempool_tx','new_block','config_update'].includes(msg.type)){\n         console.log(`âš¡ Event ${msg.type} received â†’ rebuilding template`);\n-        abortFlag = true;\n+        abortFlag=true;\n       }\n-    } catch (e) { }\n+    }catch(e){}\n   });\n-  ws.on('close', () => { console.log('WS closed â†’ reconnecting...'); setTimeout(startWS, 3000); });\n+  ws.on('close',()=>{console.log('WS closed â†’ reconnecting...');setTimeout(startWS,3000);});\n }\n console.log('ðŸš€ Continuous miner started (PoW simulation)');\n startWS();\n mineLoop();\n"
                },
                {
                    "date": 1761984247113,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,91 +1,126 @@\n-// miner.js (continuous PoW loop)\n+// miner.js - Bitcoin-like continuous PoW miner\n+//-----------------------------------------------------\n const axios = require('axios');\n const crypto = require('crypto');\n const WebSocket = require('ws');\n \n+// ðŸ”— Node connection\n const NODE_HTTP = 'http://localhost:3000';\n const NODE_WS = 'ws://localhost:3000';\n-const MINER_ADDRESS = process.env.MINER_ADDRESS || 'your_miner_address_here';\n \n+// ðŸ’³ Miner payout address\n+const MINER_ADDRESS = process.env.MINER_ADDRESS || 'miner_address_here';\n+\n+// ----------------------------------------------------\n+// Utils\n+//----------------------------------------------------\n const sha256hex = d => crypto.createHash('sha256').update(d).digest('hex');\n-function blockHash(b){return sha256hex(b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty);}\n+function blockHash(b) {\n+  return sha256hex(\n+    b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty\n+  );\n+}\n \n let abortFlag = false;\n let currentDiff = 1;\n+let totalMined = 0;\n \n+// ----------------------------------------------------\n+// Build block template from node\n+//----------------------------------------------------\n async function buildTemplate() {\n-  const [{data:chainData},{data:memData},{data:conf}] = await Promise.all([\n+  const [{ data: chainData }, { data: memData }, { data: conf }] = await Promise.all([\n     axios.get(`${NODE_HTTP}/chain`),\n     axios.get(`${NODE_HTTP}/mempool`),\n     axios.get(`${NODE_HTTP}/config`)\n   ]);\n+\n   const chain = chainData.chain;\n   const mempool = memData.mempool || [];\n   currentDiff = conf.difficulty;\n-  const reward = conf.blockReward;\n-  const fees = mempool.reduce((a,t)=>a+(t.fee||0),0);\n-  const last = chain[chain.length-1];\n+  const reward = conf.blockSubsidy;\n+  const fees = mempool.reduce((a, t) => a + (t.fee || 0), 0);\n+  const last = chain[chain.length - 1];\n   const index = chain.length;\n   const previousHash = last.hash;\n   const timestamp = new Date().toISOString();\n+\n+  // Coinbase transaction for miner reward\n   const coinbase = {\n-    id: sha256hex('coinbase'+Date.now()),\n+    id: sha256hex('coinbase' + Date.now()),\n     inputs: [],\n     outputs: [{ address: MINER_ADDRESS, amount: reward + fees }]\n   };\n-  return {index, previousHash, timestamp, txs:[coinbase,...mempool], diff:conf.difficulty};\n+\n+  return { index, previousHash, timestamp, txs: [coinbase, ...mempool], diff: conf.difficulty };\n }\n \n-async function mineLoop(){\n-  while(true){\n-    try{\n+// ----------------------------------------------------\n+// Mining loop (continuous PoW)\n+//----------------------------------------------------\n+async function mineLoop() {\n+  while (true) {\n+    try {\n       const tpl = await buildTemplate();\n-      const {index,previousHash,timestamp,txs,diff} = tpl;\n+      const { index, previousHash, timestamp, txs, diff } = tpl;\n       abortFlag = false;\n-      console.log(`â› Mining block #${index} | diff=${diff} | txs=${txs.length}`);\n-      let nonce=0;\n+      let nonce = 0;\n       let hash;\n+\n+      console.log(`\\nâ›ï¸  Starting block #${index} | diff=${diff} | txs=${txs.length}`);\n+\n       const start = Date.now();\n-      while(true){\n-        if(abortFlag) break;\n-        const block = {index,previousHash,timestamp,transactions:txs,nonce,difficulty:diff};\n+      while (!abortFlag) {\n+        const block = { index, previousHash, timestamp, transactions: txs, nonce, difficulty: diff };\n         hash = blockHash(block);\n-        if(hash.startsWith('0'.repeat(diff))){\n+\n+        if (hash.startsWith('0'.repeat(diff))) {\n+          const took = ((Date.now() - start) / 1000).toFixed(2);\n           block.hash = hash;\n-          const took=((Date.now()-start)/1000).toFixed(2);\n-          console.log(`âœ… Block mined #${index} | time=${took}s | hash=${hash}`);\n-          try{\n-            const res = await axios.post(`${NODE_HTTP}/blocks`,block);\n-            console.log('ðŸ“¦ Submitted:',res.data);\n-          }catch(e){\n-            console.error('âŒ Submit error:',e.response?.data||e.message);\n+          totalMined++;\n+          console.log(`âœ… Mined block #${index} | time=${took}s | hash=${hash}`);\n+          try {\n+            const res = await axios.post(`${NODE_HTTP}/blocks`, block);\n+            console.log('ðŸ“¦ Submitted:', res.data);\n+          } catch (e) {\n+            console.error('âŒ Submit error:', e.response?.data || e.message);\n           }\n-          break;\n+          break; // done, rebuild next block\n         }\n         nonce++;\n-        if(nonce%100000===0) process.stdout.write(`\\rnonce=${nonce}`);\n+        if (nonce % 500000 === 0) process.stdout.write(`\\rnonce=${nonce}`);\n       }\n-    }catch(e){\n-      console.error('Miner error:', e.message);\n+    } catch (e) {\n+      console.error('âš ï¸ Miner error:', e.message);\n+      await new Promise(r => setTimeout(r, 2000));\n     }\n   }\n }\n \n-// WebSocket listening (abort+restart)\n-function startWS(){\n+// ----------------------------------------------------\n+// WebSocket event listener (abort on updates)\n+//----------------------------------------------------\n+function startWS() {\n   const ws = new WebSocket(NODE_WS);\n-  ws.on('open',()=>console.log('ðŸ”Œ Connected to node'));\n-  ws.on('message',buf=>{\n-    try{\n-      const msg=JSON.parse(buf.toString());\n-      if(['mempool_tx','new_block','config_update'].includes(msg.type)){\n-        console.log(`âš¡ Event ${msg.type} received â†’ rebuilding template`);\n-        abortFlag=true;\n+  ws.on('open', () => console.log('ðŸ”Œ Connected to node'));\n+  ws.on('message', buf => {\n+    try {\n+      const msg = JSON.parse(buf.toString());\n+      if (['new_block', 'mempool_tx', 'config_update'].includes(msg.type)) {\n+        console.log(`âš¡ ${msg.type} â†’ abort current mining`);\n+        abortFlag = true;\n       }\n-    }catch(e){}\n+    } catch {}\n   });\n-  ws.on('close',()=>{console.log('WS closed â†’ reconnecting...');setTimeout(startWS,3000);});\n+  ws.on('close', () => {\n+    console.log('ðŸ”„ WS closed â†’ reconnecting...');\n+    setTimeout(startWS, 3000);\n+  });\n }\n-console.log('ðŸš€ Continuous miner started (PoW simulation)');\n+\n+// ----------------------------------------------------\n+// Start miner\n+//----------------------------------------------------\n+console.log('ðŸš€ Bitcoin-like miner started');\n startWS();\n mineLoop();\n"
                },
                {
                    "date": 1761984594433,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,13 +106,22 @@\n   ws.on('message', buf => {\n     try {\n       const msg = JSON.parse(buf.toString());\n       if (['new_block', 'mempool_tx', 'config_update'].includes(msg.type)) {\n-        console.log(`âš¡ ${msg.type} â†’ abort current mining`);\n+        console.log(`âš¡ ${msg.type} â†’ abort current mining and refresh template`);\n         abortFlag = true;\n+\n+        // Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ú†Ù†Ø¯ Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù† ØªØ§ Ø­Ù„Ù‚Ù‡ Ù‚Ø¨Ù„ÛŒ ØªÙ…ÙˆÙ… Ø´Ù‡\n+        setTimeout(() => {\n+          // mineLoop Ø®ÙˆØ¯Ø´ Ø¯Ø± Ø­Ù„Ù‚Ù‡â€ŒÛŒ while(true) Ù‡Ø³Øª Ùˆ Ø¨Ø¹Ø¯ Ø§Ø² abort Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø² Ù†Ùˆ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ù‡\n+          console.log('ðŸ” Miner ready to rebuild block template...');\n+        }, 200);\n       }\n-    } catch {}\n+    } catch (e) {\n+      console.error('âš ï¸ Bad WS message', e.message);\n+    }\n   });\n+\n   ws.on('close', () => {\n     console.log('ðŸ”„ WS closed â†’ reconnecting...');\n     setTimeout(startWS, 3000);\n   });\n"
                },
                {
                    "date": 1761984601399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -109,11 +109,9 @@\n       if (['new_block', 'mempool_tx', 'config_update'].includes(msg.type)) {\n         console.log(`âš¡ ${msg.type} â†’ abort current mining and refresh template`);\n         abortFlag = true;\n \n-        // Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ú†Ù†Ø¯ Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù† ØªØ§ Ø­Ù„Ù‚Ù‡ Ù‚Ø¨Ù„ÛŒ ØªÙ…ÙˆÙ… Ø´Ù‡\n         setTimeout(() => {\n-          // mineLoop Ø®ÙˆØ¯Ø´ Ø¯Ø± Ø­Ù„Ù‚Ù‡â€ŒÛŒ while(true) Ù‡Ø³Øª Ùˆ Ø¨Ø¹Ø¯ Ø§Ø² abort Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø² Ù†Ùˆ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ù‡\n           console.log('ðŸ” Miner ready to rebuild block template...');\n         }, 200);\n       }\n     } catch (e) {\n"
                },
                {
                    "date": 1761984619649,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,34 +1,35 @@\n-// miner.js - Bitcoin-like continuous PoW miner\n-//-----------------------------------------------------\n+// miner.js - Advanced Bitcoin-like miner with Hashrate stats\n+//-----------------------------------------------------------\n const axios = require('axios');\n const crypto = require('crypto');\n const WebSocket = require('ws');\n \n-// ðŸ”— Node connection\n+// Node endpoints\n const NODE_HTTP = 'http://localhost:3000';\n const NODE_WS = 'ws://localhost:3000';\n \n-// ðŸ’³ Miner payout address\n+// Miner payout address\n const MINER_ADDRESS = process.env.MINER_ADDRESS || 'miner_address_here';\n \n-// ----------------------------------------------------\n-// Utils\n-//----------------------------------------------------\n+// Hash helpers\n const sha256hex = d => crypto.createHash('sha256').update(d).digest('hex');\n function blockHash(b) {\n   return sha256hex(\n     b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty\n   );\n }\n \n+// Global mining stats\n let abortFlag = false;\n+let totalMined = 0;\n let currentDiff = 1;\n-let totalMined = 0;\n+let blockTimes = []; // track block durations for average\n+let hashrateWindow = []; // short rolling window for hashrate\n \n-// ----------------------------------------------------\n+//-----------------------------------------------------------\n // Build block template from node\n-//----------------------------------------------------\n+//-----------------------------------------------------------\n async function buildTemplate() {\n   const [{ data: chainData }, { data: memData }, { data: conf }] = await Promise.all([\n     axios.get(`${NODE_HTTP}/chain`),\n     axios.get(`${NODE_HTTP}/mempool`),\n@@ -37,16 +38,16 @@\n \n   const chain = chainData.chain;\n   const mempool = memData.mempool || [];\n   currentDiff = conf.difficulty;\n+\n   const reward = conf.blockSubsidy;\n   const fees = mempool.reduce((a, t) => a + (t.fee || 0), 0);\n   const last = chain[chain.length - 1];\n   const index = chain.length;\n   const previousHash = last.hash;\n   const timestamp = new Date().toISOString();\n \n-  // Coinbase transaction for miner reward\n   const coinbase = {\n     id: sha256hex('coinbase' + Date.now()),\n     inputs: [],\n     outputs: [{ address: MINER_ADDRESS, amount: reward + fees }]\n@@ -54,11 +55,11 @@\n \n   return { index, previousHash, timestamp, txs: [coinbase, ...mempool], diff: conf.difficulty };\n }\n \n-// ----------------------------------------------------\n-// Mining loop (continuous PoW)\n-//----------------------------------------------------\n+//-----------------------------------------------------------\n+// Mining loop (continuous Proof-of-Work)\n+//-----------------------------------------------------------\n async function mineLoop() {\n   while (true) {\n     try {\n       const tpl = await buildTemplate();\n@@ -66,68 +67,95 @@\n       abortFlag = false;\n       let nonce = 0;\n       let hash;\n \n-      console.log(`\\nâ›ï¸  Starting block #${index} | diff=${diff} | txs=${txs.length}`);\n+      console.log(`\\nâ›ï¸  Mining block #${index} | diff=${diff} | txs=${txs.length}`);\n \n       const start = Date.now();\n+      let lastHashCheck = start;\n+      let hashesTried = 0;\n+\n       while (!abortFlag) {\n         const block = { index, previousHash, timestamp, transactions: txs, nonce, difficulty: diff };\n         hash = blockHash(block);\n+        hashesTried++;\n \n+        // Check every 1 million hashes to measure hashrate\n+        if (hashesTried % 1_000_000 === 0) {\n+          const now = Date.now();\n+          const elapsedSec = (now - lastHashCheck) / 1000;\n+          const hashrate = (1_000_000 / elapsedSec) / 1_000_000; // MH/s\n+          process.stdout.write(`\\râš™ï¸  Hashrate â‰ˆ ${hashrate.toFixed(2)} MH/s`);\n+          hashrateWindow.push(hashrate);\n+          if (hashrateWindow.length > 10) hashrateWindow.shift();\n+          lastHashCheck = now;\n+        }\n+\n         if (hash.startsWith('0'.repeat(diff))) {\n-          const took = ((Date.now() - start) / 1000).toFixed(2);\n+          const took = (Date.now() - start) / 1000;\n           block.hash = hash;\n           totalMined++;\n-          console.log(`âœ… Mined block #${index} | time=${took}s | hash=${hash}`);\n+\n+          blockTimes.push(took);\n+          if (blockTimes.length > 10) blockTimes.shift();\n+\n+          const avgTime =\n+            blockTimes.reduce((a, b) => a + b, 0) / blockTimes.length;\n+\n+          const avgHashrate =\n+            hashrateWindow.reduce((a, b) => a + b, 0) / hashrateWindow.length || 0;\n+\n+          console.log(\n+            `\\nâœ… Block mined #${index} | time=${took.toFixed(2)}s | hash=${hash}`\n+          );\n+          console.log(\n+            `ðŸ“Š Stats â†’ Avg block time: ${avgTime.toFixed(2)}s | Avg Hashrate: ${avgHashrate.toFixed(2)} MH/s`\n+          );\n+\n           try {\n             const res = await axios.post(`${NODE_HTTP}/blocks`, block);\n             console.log('ðŸ“¦ Submitted:', res.data);\n           } catch (e) {\n             console.error('âŒ Submit error:', e.response?.data || e.message);\n           }\n-          break; // done, rebuild next block\n+\n+          break;\n         }\n+\n         nonce++;\n-        if (nonce % 500000 === 0) process.stdout.write(`\\rnonce=${nonce}`);\n       }\n     } catch (e) {\n       console.error('âš ï¸ Miner error:', e.message);\n       await new Promise(r => setTimeout(r, 2000));\n     }\n   }\n }\n \n-// ----------------------------------------------------\n-// WebSocket event listener (abort on updates)\n-//----------------------------------------------------\n+//-----------------------------------------------------------\n+// WebSocket listener - abort on new events\n+//-----------------------------------------------------------\n function startWS() {\n   const ws = new WebSocket(NODE_WS);\n   ws.on('open', () => console.log('ðŸ”Œ Connected to node'));\n   ws.on('message', buf => {\n     try {\n       const msg = JSON.parse(buf.toString());\n       if (['new_block', 'mempool_tx', 'config_update'].includes(msg.type)) {\n-        console.log(`âš¡ ${msg.type} â†’ abort current mining and refresh template`);\n+        console.log(`âš¡ ${msg.type} â†’ abort current mining`);\n         abortFlag = true;\n-\n-        setTimeout(() => {\n-          console.log('ðŸ” Miner ready to rebuild block template...');\n-        }, 200);\n       }\n     } catch (e) {\n       console.error('âš ï¸ Bad WS message', e.message);\n     }\n   });\n-\n   ws.on('close', () => {\n     console.log('ðŸ”„ WS closed â†’ reconnecting...');\n     setTimeout(startWS, 3000);\n   });\n }\n \n-// ----------------------------------------------------\n-// Start miner\n-//----------------------------------------------------\n-console.log('ðŸš€ Bitcoin-like miner started');\n+//-----------------------------------------------------------\n+// Start the miner\n+//-----------------------------------------------------------\n+console.log('ðŸš€ Bitcoin-like miner started with live stats');\n startWS();\n mineLoop();\n"
                },
                {
                    "date": 1761984855449,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,16 @@\n   return sha256hex(\n     b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty\n   );\n }\n+// Compute numeric target based on difficulty\n+function getTarget(difficulty) {\n+  const maxTarget = BigInt('0x' + 'f'.repeat(64)); // 2^256 - 1\n+  const target = maxTarget / BigInt(difficulty);\n+  return target;\n+}\n \n+\n // Global mining stats\n let abortFlag = false;\n let totalMined = 0;\n let currentDiff = 1;\n"
                },
                {
                    "date": 1761984907865,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -96,9 +96,10 @@\n           if (hashrateWindow.length > 10) hashrateWindow.shift();\n           lastHashCheck = now;\n         }\n \n-        if (hash.startsWith('0'.repeat(diff))) {\n+        const hashInt = BigInt('0x' + hash);\n+        if (hashInt < target) {\n           const took = (Date.now() - start) / 1000;\n           block.hash = hash;\n           totalMined++;\n \n"
                },
                {
                    "date": 1761984924568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,8 +76,9 @@\n       let hash;\n \n       console.log(`\\nâ›ï¸  Mining block #${index} | diff=${diff} | txs=${txs.length}`);\n \n+      const target = getTarget(diff);\n       const start = Date.now();\n       let lastHashCheck = start;\n       let hashesTried = 0;\n \n"
                },
                {
                    "date": 1761984957266,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,11 +74,11 @@\n       abortFlag = false;\n       let nonce = 0;\n       let hash;\n \n-      console.log(`\\nâ›ï¸  Mining block #${index} | diff=${diff} | txs=${txs.length}`);\n+      const target = getTarget(diff);\n+      console.log(`\\nâ›ï¸ Mining block #${index} | diff=${diff} | target=${target.toString(16).slice(0, 16)}...`);\n \n-      const target = getTarget(diff);\n       const start = Date.now();\n       let lastHashCheck = start;\n       let hashesTried = 0;\n \n"
                },
                {
                    "date": 1761985055072,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-// miner.js - Advanced Bitcoin-like miner with Hashrate stats\n+// miner.js - Full Bitcoin-like miner (Target-based PoW + Live Stats)\n //-----------------------------------------------------------\n const axios = require('axios');\n const crypto = require('crypto');\n const WebSocket = require('ws');\n@@ -10,33 +10,42 @@\n \n // Miner payout address\n const MINER_ADDRESS = process.env.MINER_ADDRESS || 'miner_address_here';\n \n-// Hash helpers\n+//-----------------------------------------------\n+// ðŸ”¹ Hash & Target Utilities\n+//-----------------------------------------------\n const sha256hex = d => crypto.createHash('sha256').update(d).digest('hex');\n+\n function blockHash(b) {\n   return sha256hex(\n-    b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty\n+    b.index +\n+    b.previousHash +\n+    b.timestamp +\n+    JSON.stringify(b.transactions) +\n+    b.nonce +\n+    b.difficulty\n   );\n }\n-// Compute numeric target based on difficulty\n+\n+// Convert difficulty â†’ numeric PoW target\n function getTarget(difficulty) {\n   const maxTarget = BigInt('0x' + 'f'.repeat(64)); // 2^256 - 1\n-  const target = maxTarget / BigInt(difficulty);\n-  return target;\n+  return maxTarget / BigInt(difficulty);\n }\n \n-\n-// Global mining stats\n+//-----------------------------------------------\n+// ðŸ”¹ Global mining state\n+//-----------------------------------------------\n let abortFlag = false;\n let totalMined = 0;\n let currentDiff = 1;\n-let blockTimes = []; // track block durations for average\n-let hashrateWindow = []; // short rolling window for hashrate\n+let blockTimes = [];\n+let hashrateWindow = [];\n \n-//-----------------------------------------------------------\n-// Build block template from node\n-//-----------------------------------------------------------\n+//-----------------------------------------------\n+// ðŸ”¹ Fetch block template from node\n+//-----------------------------------------------\n async function buildTemplate() {\n   const [{ data: chainData }, { data: memData }, { data: conf }] = await Promise.all([\n     axios.get(`${NODE_HTTP}/chain`),\n     axios.get(`${NODE_HTTP}/mempool`),\n@@ -62,23 +71,23 @@\n \n   return { index, previousHash, timestamp, txs: [coinbase, ...mempool], diff: conf.difficulty };\n }\n \n-//-----------------------------------------------------------\n-// Mining loop (continuous Proof-of-Work)\n-//-----------------------------------------------------------\n+//-----------------------------------------------\n+// ðŸ”¹ Main mining loop (with target-based PoW)\n+//-----------------------------------------------\n async function mineLoop() {\n   while (true) {\n     try {\n       const tpl = await buildTemplate();\n       const { index, previousHash, timestamp, txs, diff } = tpl;\n       abortFlag = false;\n-      let nonce = 0;\n-      let hash;\n \n       const target = getTarget(diff);\n-      console.log(`\\nâ›ï¸ Mining block #${index} | diff=${diff} | target=${target.toString(16).slice(0, 16)}...`);\n+      console.log(`\\nâ›ï¸  Mining block #${index} | diff=${diff} | txs=${txs.length}`);\n \n+      let nonce = 0;\n+      let hash;\n       const start = Date.now();\n       let lastHashCheck = start;\n       let hashesTried = 0;\n \n@@ -86,9 +95,9 @@\n         const block = { index, previousHash, timestamp, transactions: txs, nonce, difficulty: diff };\n         hash = blockHash(block);\n         hashesTried++;\n \n-        // Check every 1 million hashes to measure hashrate\n+        // Measure hashrate every 1M tries\n         if (hashesTried % 1_000_000 === 0) {\n           const now = Date.now();\n           const elapsedSec = (now - lastHashCheck) / 1000;\n           const hashrate = (1_000_000 / elapsedSec) / 1_000_000; // MH/s\n@@ -97,8 +106,9 @@\n           if (hashrateWindow.length > 10) hashrateWindow.shift();\n           lastHashCheck = now;\n         }\n \n+        // âœ… Real Proof-of-Work check (numeric comparison)\n         const hashInt = BigInt('0x' + hash);\n         if (hashInt < target) {\n           const took = (Date.now() - start) / 1000;\n           block.hash = hash;\n@@ -106,29 +116,24 @@\n \n           blockTimes.push(took);\n           if (blockTimes.length > 10) blockTimes.shift();\n \n-          const avgTime =\n-            blockTimes.reduce((a, b) => a + b, 0) / blockTimes.length;\n+          const avgTime = blockTimes.reduce((a, b) => a + b, 0) / blockTimes.length;\n+          const avgHashrate = hashrateWindow.reduce((a, b) => a + b, 0) / hashrateWindow.length || 0;\n \n-          const avgHashrate =\n-            hashrateWindow.reduce((a, b) => a + b, 0) / hashrateWindow.length || 0;\n+          console.log(`\\nâœ… Block mined #${index} | time=${took.toFixed(2)}s`);\n+          console.log(`ðŸ“Š Stats â†’ Avg block time: ${avgTime.toFixed(2)}s | Avg Hashrate: ${avgHashrate.toFixed(2)} MH/s`);\n+          console.log(`ðŸ”¢ hash = ${hash}`);\n+          console.log(`ðŸŽ¯ target = ${target.toString(16).slice(0, 16)}...`);\n \n-          console.log(\n-            `\\nâœ… Block mined #${index} | time=${took.toFixed(2)}s | hash=${hash}`\n-          );\n-          console.log(\n-            `ðŸ“Š Stats â†’ Avg block time: ${avgTime.toFixed(2)}s | Avg Hashrate: ${avgHashrate.toFixed(2)} MH/s`\n-          );\n-\n           try {\n             const res = await axios.post(`${NODE_HTTP}/blocks`, block);\n             console.log('ðŸ“¦ Submitted:', res.data);\n           } catch (e) {\n             console.error('âŒ Submit error:', e.response?.data || e.message);\n           }\n \n-          break;\n+          break; // break inner loop â†’ new template\n         }\n \n         nonce++;\n       }\n@@ -138,11 +143,11 @@\n     }\n   }\n }\n \n-//-----------------------------------------------------------\n-// WebSocket listener - abort on new events\n-//-----------------------------------------------------------\n+//-----------------------------------------------\n+// ðŸ”¹ WebSocket listener (react to network updates)\n+//-----------------------------------------------\n function startWS() {\n   const ws = new WebSocket(NODE_WS);\n   ws.on('open', () => console.log('ðŸ”Œ Connected to node'));\n   ws.on('message', buf => {\n@@ -152,19 +157,19 @@\n         console.log(`âš¡ ${msg.type} â†’ abort current mining`);\n         abortFlag = true;\n       }\n     } catch (e) {\n-      console.error('âš ï¸ Bad WS message', e.message);\n+      console.error('âš ï¸ WS parse error:', e.message);\n     }\n   });\n   ws.on('close', () => {\n     console.log('ðŸ”„ WS closed â†’ reconnecting...');\n     setTimeout(startWS, 3000);\n   });\n }\n \n-//-----------------------------------------------------------\n-// Start the miner\n-//-----------------------------------------------------------\n-console.log('ðŸš€ Bitcoin-like miner started with live stats');\n+//-----------------------------------------------\n+// ðŸ”¹ Start miner\n+//-----------------------------------------------\n+console.log('ðŸš€ Full-featured Bitcoin-like miner started');\n startWS();\n mineLoop();\n"
                },
                {
                    "date": 1761985621284,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n //-----------------------------------------------------------\n const axios = require('axios');\n const crypto = require('crypto');\n const WebSocket = require('ws');\n+const argv = require('minimist')(process.argv.slice(2));\n \n // Node endpoints\n const NODE_HTTP = 'http://localhost:3000';\n const NODE_WS = 'ws://localhost:3000';\n"
                },
                {
                    "date": 1761985725205,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n const NODE_HTTP = 'http://localhost:3000';\n const NODE_WS = 'ws://localhost:3000';\n \n // Miner payout address\n-const MINER_ADDRESS = process.env.MINER_ADDRESS || 'miner_address_here';\n+const addressPub = argv.address || 'miner_address_here';\n \n //-----------------------------------------------\n // ðŸ”¹ Hash & Target Utilities\n //-----------------------------------------------\n@@ -66,9 +66,9 @@\n \n   const coinbase = {\n     id: sha256hex('coinbase' + Date.now()),\n     inputs: [],\n-    outputs: [{ address: MINER_ADDRESS, amount: reward + fees }]\n+    outputs: [{ address: addressPub, amount: reward + fees }]\n   };\n \n   return { index, previousHash, timestamp, txs: [coinbase, ...mempool], diff: conf.difficulty };\n }\n"
                },
                {
                    "date": 1761986553419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,13 @@\n // Node endpoints\n const NODE_HTTP = 'http://localhost:3000';\n const NODE_WS = 'ws://localhost:3000';\n \n+if (!argv.address) {\n+  console.error('Usage: node miner.js --address <ADDRESS>');\n+  process.exit(1);\n+}\n+\n // Miner payout address\n const addressPub = argv.address || 'miner_address_here';\n \n //-----------------------------------------------\n"
                },
                {
                    "date": 1761986564204,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,9 +14,9 @@\n   process.exit(1);\n }\n \n // Miner payout address\n-const addressPub = argv.address || 'miner_address_here';\n+const addressPub = argv.address;\n \n //-----------------------------------------------\n // ðŸ”¹ Hash & Target Utilities\n //-----------------------------------------------\n"
                },
                {
                    "date": 1761986585071,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,9 +14,9 @@\n   process.exit(1);\n }\n \n // Miner payout address\n-const addressPub = argv.address;\n+const ADDRESS = argv.address;\n \n //-----------------------------------------------\n // ðŸ”¹ Hash & Target Utilities\n //-----------------------------------------------\n@@ -71,9 +71,9 @@\n \n   const coinbase = {\n     id: sha256hex('coinbase' + Date.now()),\n     inputs: [],\n-    outputs: [{ address: addressPub, amount: reward + fees }]\n+    outputs: [{ address: ADDRESS, amount: reward + fees }]\n   };\n \n   return { index, previousHash, timestamp, txs: [coinbase, ...mempool], diff: conf.difficulty };\n }\n"
                },
                {
                    "date": 1761986606885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,18 +4,16 @@\n const crypto = require('crypto');\n const WebSocket = require('ws');\n const argv = require('minimist')(process.argv.slice(2));\n \n-// Node endpoints\n-const NODE_HTTP = 'http://localhost:3000';\n-const NODE_WS = 'ws://localhost:3000';\n-\n if (!argv.address) {\n   console.error('Usage: node miner.js --address <ADDRESS>');\n   process.exit(1);\n }\n \n-// Miner payout address\n+// Node endpoints\n+const NODE_HTTP = 'http://localhost:3000';\n+const NODE_WS = 'ws://localhost:3000';\n const ADDRESS = argv.address;\n \n //-----------------------------------------------\n // ðŸ”¹ Hash & Target Utilities\n"
                }
            ],
            "date": 1761981160924,
            "name": "Commit-0",
            "content": "// miner.js (continuous PoW loop)\nconst axios = require('axios');\nconst crypto = require('crypto');\nconst WebSocket = require('ws');\n\nconst NODE_HTTP = 'http://localhost:3000';\nconst NODE_WS = 'ws://localhost:3000';\nconst MINER_ADDRESS = process.env.MINER_ADDRESS || 'your_miner_address_here';\n\nconst sha256hex = d => crypto.createHash('sha256').update(d).digest('hex');\nfunction blockHash(b) { return sha256hex(b.index + b.previousHash + b.timestamp + JSON.stringify(b.transactions) + b.nonce + b.difficulty); }\n\nfunction merkleRoot(txids) {\n  if (txids.length === 0) return sha256hex('');\n  let layer = txids.map(x => Buffer.from(x, 'hex'));\n  while (layer.length > 1) {\n    const next = [];\n    for (let i = 0; i < layer.length; i += 2) {\n      const left = layer[i];\n      const right = layer[i + 1] || left; // duplicate odd leaf\n      next.push(sha256(Buffer.concat([left, right])));\n    }\n    layer = next;\n  }\n  return layer[0].toString('hex');\n}\n\nfunction headerHash(header) { // canonical, no JSON\n  const data = [\n    String(header.index), header.previousHash, String(header.timestamp),\n    header.merkleRoot, String(header.nonce), String(header.difficulty)\n  ].join('|'); // simple, deterministic serialization\n  return sha256hex(data);\n}\n\nlet abortFlag = false;\nlet currentDiff = 1;\n\nasync function buildTemplate() {\n  const [{ data: chainData }, { data: memData }, { data: conf }] = await Promise.all([\n    axios.get(`${NODE_HTTP}/chain`),\n    axios.get(`${NODE_HTTP}/mempool`),\n    axios.get(`${NODE_HTTP}/config`)\n  ]);\n  const chain = chainData.chain;\n  const mempool = memData.mempool || [];\n  currentDiff = conf.difficulty;\n  const reward = conf.blockReward;\n  const fees = mempool.reduce((a, t) => a + (t.fee || 0), 0);\n  const last = chain[chain.length - 1];\n  const index = chain.length;\n  const previousHash = last.hash;\n  const timestamp = new Date().toISOString();\n  const coinbase = {\n    id: sha256hex('coinbase' + Date.now()),\n    inputs: [],\n    outputs: [{ address: MINER_ADDRESS, amount: reward + fees }]\n  };\n  return { index, previousHash, timestamp, txs: [coinbase, ...mempool], diff: conf.difficulty };\n}\n\nasync function mineLoop() {\n  while (true) {\n    try {\n      const tpl = await buildTemplate();\n      const { index, previousHash, timestamp, txs, diff } = tpl;\n      abortFlag = false;\n      console.log(`â› Mining block #${index} | diff=${diff} | txs=${txs.length}`);\n      let nonce = 0;\n      let hash;\n      const start = Date.now();\n      while (true) {\n        if (abortFlag) break;\n        const block = { index, previousHash, timestamp, transactions: txs, nonce, difficulty: diff };\n        hash = blockHash(block);\n        if (hash.startsWith('0'.repeat(diff))) {\n          block.hash = hash;\n          const took = ((Date.now() - start) / 1000).toFixed(2);\n          console.log(`âœ… Block mined #${index} | time=${took}s | hash=${hash}`);\n          try {\n            const res = await axios.post(`${NODE_HTTP}/blocks`, block);\n            console.log('ðŸ“¦ Submitted:', res.data);\n          } catch (e) {\n            console.error('âŒ Submit error:', e.response?.data || e.message);\n          }\n          break;\n        }\n        nonce++;\n        if (nonce % 100000 === 0) process.stdout.write(`\\rnonce=${nonce}`);\n      }\n    } catch (e) {\n      console.error('Miner error:', e.message);\n    }\n  }\n}\n\n// WebSocket listening (abort+restart)\nfunction startWS() {\n  const ws = new WebSocket(NODE_WS);\n  ws.on('open', () => console.log('ðŸ”Œ Connected to node'));\n  ws.on('message', buf => {\n    try {\n      const msg = JSON.parse(buf.toString());\n      if (['mempool_tx', 'new_block', 'config_update'].includes(msg.type)) {\n        console.log(`âš¡ Event ${msg.type} received â†’ rebuilding template`);\n        abortFlag = true;\n      }\n    } catch (e) { }\n  });\n  ws.on('close', () => { console.log('WS closed â†’ reconnecting...'); setTimeout(startWS, 3000); });\n}\nconsole.log('ðŸš€ Continuous miner started (PoW simulation)');\nstartWS();\nmineLoop();\n"
        }
    ]
}